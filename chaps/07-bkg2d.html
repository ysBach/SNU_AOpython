

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>2. 2-D Backgrounds &#8212; SNU AO Class Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-examples.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chaps/07-bkg2d';</script>
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. Extended Source Photometry" href="08-extended.html" />
    <link rel="prev" title="1. Differential Photometry" href="06-diffphot.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    SNU AO Class Python Notes
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Front Matter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00-Syllabus.html">An Example Syllabus</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Prerequisite</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="prerequisites/00-1_Softwares.html">1. Software Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites/00-2_UNIX.html">2. UNIX Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites/00-3_Prepare_Python.html">3. (IMPORTANT) Python Environment</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="python_prep/00-python_prep.html">4. Python Preparation Course</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="python_prep/01-numpy.html">4.4. Numpy Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_prep/02-pandas.html">4.5. Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_prep/03-FITS_and_astropy.html">4.6. About <code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code></a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-fits-basic.html">1. Basics about FITS</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-center.html">2. Centering</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-aperture.html">3. Aperture &amp; DAOFIND</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-annulus.html">4. Annulus &amp; Local Sky</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-query.html">5. Querying from the Catalog</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Photometry</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="06-diffphot.html">1. Differential Photometry</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">2. 2-D Backgrounds</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-extended.html">3. Extended Source Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="09-psf01.html">4. PSF Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-psf02.html">5. PSF Photometry</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Long-Slit Spectroscopy</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="20-specstat.html">1. First Look at Longslit Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="21-specpreface.html">2. Python Spectroscopy Preface</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Additional Materials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="A0-crrej.html">1. Cosmic-Ray Rejection</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00-Philosophy.html">1. Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix/S01_IRAF.html">2. IRAF (DEPRECATED)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Homework Assignments</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="prerequisites/99-HW_swtools.html">HW Software &amp; Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_prep/99-HW_python_pathlib.html">HW Python Basic &amp; <code class="docutils literal notranslate"><span class="pre">pathlib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="python_prep/99-HW_numpy.html">HW <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="python_prep/99-HW_pandas.html">HW <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="python_prep/99-HW_astropy-fits.html">HW <code class="docutils literal notranslate"><span class="pre">astropy.fits</span></code></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ysBach/SNU_AOpython" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ysBach/SNU_AOpython/edit/main/chaps/07-bkg2d.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ysBach/SNU_AOpython/issues/new?title=Issue%20on%20page%20%2Fchaps/07-bkg2d.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chaps/07-bkg2d.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>2-D Backgrounds</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sextractor">2.1. SExtractor</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">2.1.1. Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#documentations">2.1.2. Documentations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementations-in-python">2.1.3. Implementations in Python</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sextractor-algorithm">2.2. SExtractor Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-detailed-explanation">2.2.1. A Detailed Explanation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sky-estimation-by-photutils-background2d">2.3. Sky Estimation by <code class="docutils literal notranslate"><span class="pre">photutils.Background2D</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sky-estimation-from-sep">2.4. Sky Estimation from <code class="docutils literal notranslate"><span class="pre">sep</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="d-backgrounds">
<span id="ch-bkg2d"></span><h1><span class="section-number">2. </span>2-D Backgrounds<a class="headerlink" href="#d-backgrounds" title="Permalink to this heading">#</a></h1>
<section id="sextractor">
<h2><span class="section-number">2.1. </span>SExtractor<a class="headerlink" href="#sextractor" title="Permalink to this heading">#</a></h2>
<p>So far, you have learned how to estimate the background (or so-called the “sky” value) at a single star, using the annulus. Although this works sufficiently good for most of the use cases, sometimes you need 2-D <strong>fitting</strong> to the background pixels, and make a 2-D background. An example will be the target in a nebulous background or galaxy.</p>
<section id="introduction">
<h3><span class="section-number">2.1.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h3>
<p>The most widely used algorithm uses <a class="reference external" href="https://www.astromatic.net/software/sextractor/">SExtractor</a> first developed by <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/1996A%26AS..117..393B/abstract">Bertin &amp; Arnouts (1996)</a>. The name came from “source extractor”, and thus this software’s primary goal is to extract sources (including stars, galaxies, asteroids, etc).</p>
<p>There are two important parts of SExtractor:</p>
<ol class="arabic simple">
<li><p>Estimation of the spatially varying background and</p></li>
<li><p>Automatic recognition of the sources (i.e., properties including shape, flux, etc).</p></li>
</ol>
<p>A general implementation of background estimation in <code class="docutils literal notranslate"><span class="pre">photutils</span></code> (<a class="reference external" href="https://photutils.readthedocs.io/en/stable/background.html"><code class="docutils literal notranslate"><span class="pre">photutils.background</span></code></a>) includes SExtractor-like background estimation (<strong>this will be covered in this note</strong>). The second part, source recognition (in <code class="docutils literal notranslate"><span class="pre">photutils</span></code>, it is implemented to <a class="reference external" href="https://photutils.readthedocs.io/en/stable/segmentation.html"><code class="docutils literal notranslate"><span class="pre">photutils.segmentation</span></code></a>) is covered in Extended Sources lecture note.</p>
</section>
<section id="documentations">
<h3><span class="section-number">2.1.2. </span>Documentations<a class="headerlink" href="#documentations" title="Permalink to this heading">#</a></h3>
<p>There are two bibles for SExtractor and I link those for you just in case you need to use it for historical reasons:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://sextractor.readthedocs.io/en/latest/">Official online manual</a> // <a class="reference external" href="https://www.astromatic.net/pubsvn/software/sextractor/trunk/doc/sextractor.pdf">official PDF manual from astromatic.net</a></p>
<ul class="simple">
<li><p>Note that the readthedocs web can be converted to PDF (<a class="reference external" href="https://sextractor.readthedocs.io/_/downloads/en/latest/pdf/">here</a>).</p></li>
</ul>
</li>
<li><p>a note called <a class="reference external" href="http://astroa.physics.metu.edu.tr/MANUALS/sextractor/Guide2source_extractor.pdf">“Source Extractor for Dummies”</a>.</p></li>
</ol>
<p>You may also find them from our <a class="reference external" href="https://github.com/ysBach/SNU_AOclass/tree/master/references">references</a>.</p>
</section>
<section id="implementations-in-python">
<h3><span class="section-number">2.1.3. </span>Implementations in Python<a class="headerlink" href="#implementations-in-python" title="Permalink to this heading">#</a></h3>
<p>In python, there are two widely used versions to mimic SExtractor:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">photutils</span></code></p></li>
<li><p><a class="reference external" href="https://sep.readthedocs.io/"><code class="docutils literal notranslate"><span class="pre">sep</span></code> (Source Extractor in Python)</a> (the <a class="reference external" href="https://joss.theoj.org/papers/10.21105/joss.00058">paper on JOSS</a>)</p></li>
</ol>
<p>The pros and cons of these are clear: <code class="docutils literal notranslate"><span class="pre">photutils</span></code> gives you more freedom, but is much slower then <code class="docutils literal notranslate"><span class="pre">sep</span></code>. <code class="docutils literal notranslate"><span class="pre">sep</span></code> uses numpy only and is much faster (see <a class="reference external" href="https://github.com/kbarbary/sep/blob/master/bench.py">benchmark</a>). However, <code class="docutils literal notranslate"><span class="pre">sep</span></code> can only do very basic calculations. I personally use <code class="docutils literal notranslate"><span class="pre">sep</span></code> for most works because it’s faster.</p>
<div class="dropdown tip admonition">
<p class="admonition-title">Benchmark on my mac</p>
<p><code class="docutils literal notranslate"><span class="pre">sep</span></code> is about 70+ times faster on my mac:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python bench.py
test image shape: (1024, 1024)
test image dtype: float32
measure background:  12.34 ms
subtract background:   3.38 ms
background array:   6.94 ms
rms array:   5.21 ms
extract:  88.87 ms  [1167 objects]

sep version:       1.10.0
photutils version: 0.7.1

| test                    | sep             | photutils       | ratio  |
|-------------------------|-----------------|-----------------|--------|
| 1024^2 image background |        11.68 ms |       851.76 ms |  72.94 |
| circles  r= 5  subpix=5 |    3.40 us/aper |   45.30 us/aper |  13.31 |
| circles  r= 5  exact    |    3.89 us/aper |   45.76 us/aper |  11.76 |
| ellipses r= 5  subpix=5 |    3.89 us/aper |   75.29 us/aper |  19.37 |
| ellipses r= 5  exact    |   10.88 us/aper |   63.71 us/aper |   5.85 |
</pre></div>
</div>
</div>
</section>
</section>
<section id="sextractor-algorithm">
<h2><span class="section-number">2.2. </span>SExtractor Algorithm<a class="headerlink" href="#sextractor-algorithm" title="Permalink to this heading">#</a></h2>
<p>Basic algorithm is explained in <a class="reference external" href="https://photutils.readthedocs.io/en/stable/background.html">this section</a> of the <code class="docutils literal notranslate"><span class="pre">photutils</span></code> documentation (as well as the SExtractor documentations linked above). SExtractor background estimation is done like this:</p>
<ol class="arabic">
<li><p>Chop image into a low-resolution image</p>
<ul class="simple">
<li><p>In case of the axis length is <strong>not</strong> an integer multiple of corresponding <code class="docutils literal notranslate"><span class="pre">box_size</span></code>, you have to specify the option (<code class="docutils literal notranslate"><span class="pre">edge_method</span></code>). But it is highly recommended not to make such situation, so set <code class="docutils literal notranslate"><span class="pre">box_size</span></code> carefully.</p></li>
</ul>
</li>
<li><p>For each box (“pad”) having <code class="docutils literal notranslate"><span class="pre">box_size</span></code>, do a median filtering with given filter size.</p>
<ul class="simple">
<li><p>The median filter will use <code class="docutils literal notranslate"><span class="pre">numpy.nan</span></code> for “outside-pad” pixels. FYI, the <a class="reference external" href="https://photutils.readthedocs.io/en/stable/_modules/photutils/background/background_2d.html#Background2D"><code class="docutils literal notranslate"><span class="pre">photutils.Background2D</span></code> source code</a> uses <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.generic_filter.html#scipy.ndimage.generic_filter"><code class="docutils literal notranslate"><span class="pre">scipy.ndimage.generic_filter</span></code></a>, and has the following code:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">background_mesh</span> <span class="o">=</span> <span class="n">generic_filter</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_mesh</span><span class="p">,</span> <span class="n">nanmedian_func</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_size</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Do the sigma-clipping based on <code class="docutils literal notranslate"><span class="pre">sigma_clip</span></code> to each of the pixel within the box after this median filtering.</p>
<ul class="simple">
<li><p>The clipping is done from <em>median</em>, not from <em>mean</em>.</p></li>
</ul>
</li>
<li><p>For the low-resolution image, do an interpolation to make a background map (size identical to the original image)</p>
<ul class="simple">
<li><p>By default, 3rd order spline fitting is used (as SExtractor default). In <code class="docutils literal notranslate"><span class="pre">photutils</span></code>, it is called <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.background.BkgZoomInterpolator.html#photutils.background.BkgZoomInterpolator"><code class="docutils literal notranslate"><span class="pre">BkgZoomInterpolator</span></code></a></p></li>
<li><p>Unlike median filtering, it has <code class="docutils literal notranslate"><span class="pre">cval=0.0</span></code>, so the values outside the range of interpolation is considered as zero-valued pads.</p></li>
<li><p>To change this, use the parameter <code class="docutils literal notranslate"><span class="pre">interpolator</span></code>.</p></li>
</ul>
</li>
<li><p>You may need some uncertainty map for the background estimation uncertainty, which is done by tuning the paramter <code class="docutils literal notranslate"><span class="pre">bkgrms_estimator</span></code>. It has the input <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.background.StdBackgroundRMS.html#photutils.background.StdBackgroundRMS"><code class="docutils literal notranslate"><span class="pre">StdBackgroundRMS</span></code></a> by default. This just calculates the sample standard deviation of the sigma-clipped data within each pad, and takes it as the pad’s background estimation RMS (roughly equal to what we call “uncertainty”). Then this low-resolution error map is also interpolated by the same way as the background value map.</p></li>
</ol>
<p>Here, the low-resolutioned image (and sometimes the “tile” or pixel of this low-res image) is called <em>background mesh</em>, <em>pad</em>, or <em>box</em>.</p>
<section id="a-detailed-explanation">
<h3><span class="section-number">2.2.1. </span>A Detailed Explanation<a class="headerlink" href="#a-detailed-explanation" title="Permalink to this heading">#</a></h3>
<p>For example, say the image was 1000 by 1000 pixel, and you set <code class="docutils literal notranslate"><span class="pre">box_size=(50,</span> <span class="pre">25)</span></code>. Then a low-resolution image consists of 20 by 40 “pads” or “meshes” will be made. Each pad will of course have size of 50 by 25.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">filter_size=3</span></code> (eqauivalent to use <code class="docutils literal notranslate"><span class="pre">filter_size=(3,</span> <span class="pre">3)</span></code>), a 3 by 3 median filter will be used to reduce sharp noised pixels at each pad. After the median filtering of a pad, the image size is still 50 by 25.</p>
<p>Within <em>each</em> of this median-filtered pad, a sigma-clipping is performed. If too many pixels inside a pad is rejected, that pad is rejected for background estimation. By default, <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.background.Background2D.html"><code class="docutils literal notranslate"><span class="pre">photutils.Background2D</span></code></a> takes <code class="docutils literal notranslate"><span class="pre">exclude_mesh_percentile=10</span></code>, which means the pad with more than 10% of pixels are rejected will be rejected.</p>
<p>Then the representative background value from each pad (which has already been median filtered and sigma-clipped) by the following algorithm:</p>
<ol class="arabic simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">2.5*median</span> <span class="pre">-</span> <span class="pre">1.5*mean</span></code> of each pad.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">(mean-median)/std</span> <span class="pre">&gt;</span> <span class="pre">0.3</span></code>, use <code class="docutils literal notranslate"><span class="pre">median</span></code>.</p></li>
</ol>
<p>This is done by <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.background.SExtractorBackground.html#photutils.background.SExtractorBackground"><code class="docutils literal notranslate"><span class="pre">SExtractorBackground</span></code></a> in <code class="docutils literal notranslate"><span class="pre">photutils</span></code>. Of course there are other options. Check the list of <a class="reference external" href="https://photutils.readthedocs.io/en/stable/background.html#module-photutils.background">API</a>. N.B.: SExtractor user manual has a typo at page 17, <code class="docutils literal notranslate"><span class="pre">photutils</span></code> mentions (<a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.background.SExtractorBackground.html#photutils.background.SExtractorBackground">link</a>).</p>
<p>Once the sky value is set for each pad, it does spline fitting of order 3 to the low-resolution map, i.e., the 20 by 40 image. Then by this fitting, the sky value is given to each of the pixel, i.e., the “sky map” of 1000 by 1000 pixel.</p>
<p>For the sky value at each pixel, we should have some uncertainty. As a rule-of-thumb, the standard deviation of the median filtered and sigma-clipped image is used. For each pad, this value is saved as a representative error, so we have 20x40 error map. The 3rd order spline fitting is also done for this error map. Then we finally have the “sky error map” of 1000x1000 pixel.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are familiar with the <code class="docutils literal notranslate"><span class="pre">photutils</span></code> code, you may wonder what will happen if you put <code class="docutils literal notranslate"><span class="pre">sigma_clip</span></code> to the <code class="docutils literal notranslate"><span class="pre">Background2D</span></code> and the <code class="docutils literal notranslate"><span class="pre">SExtractorBackground</span></code>. The <code class="docutils literal notranslate"><span class="pre">bkg_estimator</span></code> part of this <a class="reference external" href="https://photutils.readthedocs.io/en/stable/api/photutils.background.Background2D.html#photutils.background.Background2D"><code class="docutils literal notranslate"><span class="pre">Background2D</span></code> document</a> says the sigma clipping parameter from <code class="docutils literal notranslate"><span class="pre">SExtractorBackground</span></code> will be ignored.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Before proceed, please do the followings:</p>
<ol class="arabic simple">
<li><p>Read and follow the documentation and tutorial at <a class="reference external" href="https://photutils.readthedocs.io/en/stable/background.html#d-background-and-noise-estimation">photutils/background estimation</a>.</p></li>
<li><p>Read and follow the documentation and tutorial at <a class="reference external" href="https://sep.readthedocs.io/en/latest/tutorial.html#Background-subtraction">sep/Background subtraction</a> (only until Background subtraction will be enough).</p></li>
</ol>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> version_information
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S (%Z = GMT%z)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This notebook was generated at </span><span class="si">{</span><span class="n">now</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>

<span class="n">vv</span> <span class="o">=</span> <span class="o">%</span><span class="k">version_information</span> astropy, numpy, scipy, matplotlib, astroquery, photutils, version_information
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">packages</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pkg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pkg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This notebook was generated at 2023-05-09 15:37:03 (KST = GMT+0900) 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 Python     3.10.10 64bit [Clang 14.0.6 ]
1 IPython    8.13.2
2 OS         macOS 13.1 arm64 arm 64bit
3 astropy    5.2.2
4 numpy      1.24.3
5 scipy      1.10.1
6 matplotlib 3.7.1
7 astroquery 0.4.7.dev8597
8 photutils  1.6.0
9 version_information 1.0.4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s1">&#39;last_expr&#39;</span>
<span class="n">ipython</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="s1">&#39;latin modern math&#39;</span><span class="p">,</span> <span class="s1">&#39;font.size&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">:</span><span class="s1">&#39;stix&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;axes.formatter.use_mathtext&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;axes.formatter.limits&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="s1">&#39;axes.grid&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;grid.color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;grid.linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> 
    <span class="s1">&#39;xtick.top&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;ytick.right&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> 
    <span class="s1">&#39;xtick.direction&#39;</span><span class="p">:</span> <span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="s1">&#39;ytick.direction&#39;</span><span class="p">:</span> <span class="s1">&#39;inout&#39;</span><span class="p">,</span>
    <span class="s1">&#39;xtick.minor.size&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;ytick.minor.size&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>  <span class="c1"># default 2.0</span>
    <span class="s1">&#39;xtick.major.size&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span> <span class="s1">&#39;ytick.major.size&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>  <span class="c1"># default 3.5</span>
    <span class="s1">&#39;xtick.minor.visible&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;ytick.minor.visible&#39;</span><span class="p">:</span> <span class="kc">True</span>
<span class="p">})</span>

<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">sigma_clipped_stats</span><span class="p">,</span> <span class="n">SigmaClip</span>

<span class="kn">from</span> <span class="nn">photutils.background</span> <span class="kn">import</span> <span class="n">Background2D</span>

<span class="kn">import</span> <span class="nn">sep</span>
<span class="kn">import</span> <span class="nn">ysfitsutilpy</span> <span class="k">as</span> <span class="nn">yfu</span>

<span class="kn">import</span> <span class="nn">_tool_visualization</span> <span class="k">as</span> <span class="nn">vis</span>

<span class="n">FIGPATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;figs&quot;</span><span class="p">)</span>
<span class="n">DATAPATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;../../Tutorial_Data&quot;</span><span class="p">)</span>
<span class="n">fpath</span> <span class="o">=</span> <span class="n">DATAPATH</span><span class="o">/</span><span class="s2">&quot;SNUO_STX16803-kw4-4-4-20190602-135247-R-60.0_bdfw.fits&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">box</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">filt</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">bkg_path</span> <span class="o">=</span> <span class="n">fpath</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="p">(</span><span class="n">fpath</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_bkg.png&#39;</span><span class="p">)</span>
<span class="n">png_path</span> <span class="o">=</span> <span class="n">fpath</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="p">(</span><span class="n">fpath</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
<span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">hdu</span><span class="o">.</span><span class="n">data</span>

<span class="n">avg</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">sigma_clipped_stats</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">maxiters</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="n">med</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">std</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">)</span>  <span class="c1"># mask = True when pixel has high signal (possibly a celestial object)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="sky-estimation-by-photutils-background2d">
<h2><span class="section-number">2.3. </span>Sky Estimation by <code class="docutils literal notranslate"><span class="pre">photutils.Background2D</span></code><a class="headerlink" href="#sky-estimation-by-photutils-background2d" title="Permalink to this heading">#</a></h2>
<p>Basically the <code class="docutils literal notranslate"><span class="pre">sigma_clip</span></code> parameter below has almost no effect, because we already have masked all high-valued pixels using <code class="docutils literal notranslate"><span class="pre">mask</span></code>. I put it here just for your future convenience.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_sex</span> <span class="o">=</span> <span class="n">Background2D</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">box_size</span><span class="o">=</span><span class="n">box</span><span class="p">,</span>
    <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
    <span class="n">filter_size</span><span class="o">=</span><span class="n">filt</span><span class="p">,</span>
    <span class="n">exclude_percentile</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="c1"># sigma_clip=SigmaClip(sigma=3, maxiters=5, cenfunc=&#39;median&#39;, stdfunc=&#39;std&#39;)</span>
<span class="p">)</span>
<span class="n">bkgsub_sex</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">bkg_sex</span><span class="o">.</span><span class="n">background</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">data2plot</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="n">bkg_sex</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;bkg (filt=</span><span class="si">{</span><span class="n">filt</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">, box=</span><span class="si">{</span><span class="n">box</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="n">bkgsub_sex</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;bkg subtracted&quot;</span><span class="p">),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mask (pix &gt; </span><span class="si">{</span><span class="n">thresh</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="n">bkg_sex</span><span class="o">.</span><span class="n">background_mesh</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;bkg mesh&quot;</span><span class="p">),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">bkg_sex</span><span class="o">.</span><span class="n">background_rms</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;10 * bkg RMS&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data2plot</span><span class="p">:</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">zimshow</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">],</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;arr&#39;</span><span class="p">])</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">colorbaring</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">],</span> <span class="n">im</span><span class="p">)</span>
    <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>

<span class="c1"># bkg_sex.plot_meshes(ax=axs[0, 1])</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">bkg_sex</span><span class="o">.</span><span class="n">mesh_nmasked</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No mesh (pad) is masked &quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.savefig(FIGPATH / &quot;sex_bkg_01.png&quot;, bbox_inches=&#39;tight&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/06229d2c3a438eec0c05a4108bd6889503b7ef80a087040c0beff4552e8acdf2.png" src="../_images/06229d2c3a438eec0c05a4108bd6889503b7ef80a087040c0beff4552e8acdf2.png" />
</div>
</div>
<p>Figure:</p>
<ul class="simple">
<li><p><em>Top left</em> is the original image.</p></li>
<li><p><em>Top center</em> is the estimated background (note the color-bar scale are different). This is the result of the <code class="docutils literal notranslate"><span class="pre">BkgZoomInterpolator</span></code> for the bottom center image.</p></li>
<li><p><em>Top right</em> is the image after the background subtraction.</p></li>
<li><p><em>Bottom left</em> shows the masked pixels by the 5-sigma threshold (see code). These masked (yellow) pixels are not used for sigma-clippin in the corresponding mesh (pad).</p></li>
<li><p><em>Bottom center</em> shows the low-resolution background mesh. Red cross shows the mesh that are <strong>not</strong> used for background estimation because too many pixels are removed from masking or sigma-clipping (including objects or highly noisy meshes).</p></li>
<li><p><em>Bottom right</em> shows the RMS (<code class="docutils literal notranslate"><span class="pre">sqrt(sum(mesh's</span> <span class="pre">median</span> <span class="pre">-</span> <span class="pre">pixel</span> <span class="pre">value))</span></code> within mesh, and interpolate them) <strong>multiplied by 10</strong>. Note the RMS is generally low when sky values are low (Poisson noise).</p></li>
</ul>
<p>In the code above, I used <code class="docutils literal notranslate"><span class="pre">exclude_percentile=5</span></code> (which affects the red-crosses in the bottom center image). That is, if more than 5% of the pixels in the mesh (32 x 32 pixels, so 5% of it means 51.2) are masked or sigma-clipped, that mesh is not used in the background estimation interpolation.</p>
<div class="tip admonition">
<p class="admonition-title">Practice</p>
<p>What happens if <code class="docutils literal notranslate"><span class="pre">exclude_percentile=10</span></code>?</p>
</div>
</section>
<section id="sky-estimation-from-sep">
<h2><span class="section-number">2.4. </span>Sky Estimation from <code class="docutils literal notranslate"><span class="pre">sep</span></code><a class="headerlink" href="#sky-estimation-from-sep" title="Permalink to this heading">#</a></h2>
<p>There are some caveats which may help you when you start doing research using <code class="docutils literal notranslate"><span class="pre">sep</span></code>: <code class="docutils literal notranslate"><span class="pre">sep</span></code> is <em>picky</em> when it comes to the input data types. Read the note in the <a class="reference external" href="https://sep.readthedocs.io/en/v1.1.x/tutorial.html#Finally-a-brief-word-on-byte-order">sep documentation</a>. I recommend you to use a short code snippet such as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># data = # The data you want to use (e.g., ccd.data)</span>
<span class="n">data</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># OR</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">()</span>
</pre></div>
</div>
<p>(excerpt from <code class="docutils literal notranslate"><span class="pre">ysphotutilpy</span></code>). Below we have the non-native byte order error, so I used ``.byteswap().newbyteorder()`.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bkg_sep</span> <span class="o">=</span> <span class="n">sep</span><span class="o">.</span><span class="n">Background</span><span class="p">(</span>
    <span class="n">data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">(),</span>
    <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="n">box</span><span class="p">,</span> <span class="n">bh</span><span class="o">=</span><span class="n">box</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="n">filt</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">filt</span>
<span class="p">)</span>

<span class="n">bkgsub_sep</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">bkg_sep</span><span class="o">.</span><span class="n">back</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="n">data2plot</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Original data&quot;</span><span class="p">),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="n">bkg_sep</span><span class="o">.</span><span class="n">back</span><span class="p">(),</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;bkg (filt=</span><span class="si">{</span><span class="n">filt</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">, box=</span><span class="si">{</span><span class="n">box</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="n">bkgsub_sep</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;bkg subtracted&quot;</span><span class="p">),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mask (pix &gt; </span><span class="si">{</span><span class="n">thresh</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">),</span>
    <span class="nb">dict</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">arr</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">bkg_sep</span><span class="o">.</span><span class="n">rms</span><span class="p">(),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;10 * bkg RMS&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">data2plot</span><span class="p">:</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">zimshow</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">],</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;arr&#39;</span><span class="p">])</span>
    <span class="n">vis</span><span class="o">.</span><span class="n">colorbaring</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">],</span> <span class="n">im</span><span class="p">)</span>
    <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1"># plt.savefig(FIGPATH / &quot;sex_bkg_01.png&quot;, bbox_inches=&#39;tight&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5eb5391230cc0051a25078c9234851370a7d0f9d39316de62442e7562fe986fd.png" src="../_images/5eb5391230cc0051a25078c9234851370a7d0f9d39316de62442e7562fe986fd.png" />
</div>
</div>
<p>Note the bottom center plot is not plotted, because the mesh information is not provided in <code class="docutils literal notranslate"><span class="pre">sep</span></code>. The difference in background values from the two methods:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span> <span class="o">=</span> <span class="n">bkg_sex</span><span class="o">.</span><span class="n">background</span> <span class="o">-</span> <span class="n">bkg_sep</span><span class="o">.</span><span class="n">back</span><span class="p">()</span>
<span class="n">ss</span> <span class="o">=</span> <span class="n">yfu</span><span class="o">.</span><span class="n">give_stats</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Statistics of the difference&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ss</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">:</span><span class="s2">&gt;14s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">absmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
<span class="n">im0</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">absmax</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">absmax</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">vis</span><span class="o">.</span><span class="n">colorbaring</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">im0</span><span class="p">)</span>

<span class="n">im1</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">diff</span><span class="o">/</span><span class="n">bkg_sex</span><span class="o">.</span><span class="n">background_rms</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">vis</span><span class="o">.</span><span class="n">colorbaring</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">im1</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Difference (phtotutils SEx - sep)&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;10 * Difference/photutils RMS</span><span class="se">\n</span><span class="s2">i.e., 10*difference in sigma unit&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># plt.savefig(figoutpath, dpi=300, bbox_inches = &quot;tight&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Statistics of the difference
           num: 1048576
           min: -6.857295142906423
           max: 3.0729636590508562
           avg: -0.09737848032452191
           med: 0.0026730014051281614
           std: 0.5489521792690334
        madstd: 0.07000631371216799
   percentiles: [1, 99]
           pct: [-2.93927157  0.69085835]
        slices: None
          zmin: -0.47009813126558825
          zmax: 0.4798942741889543
</pre></div>
</div>
<img alt="../_images/f7e707a43ccd8a8c4e74db6dda6abf5177cda95ed88e29bab225f4cfb9745647.png" src="../_images/f7e707a43ccd8a8c4e74db6dda6abf5177cda95ed88e29bab225f4cfb9745647.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Why are they different? It is because <code class="docutils literal notranslate"><span class="pre">sep</span></code> does not have functionality as <code class="docutils literal notranslate"><span class="pre">exclude_percentile</span></code>. Therefore, as you can see, the sky value estimated from this mesh is slightly higher in <code class="docutils literal notranslate"><span class="pre">sep</span></code> so the difference map is negative. If you increase box size and/or filter size, this problem will be “smoothed out”.</p>
<p>Hence, the lesson you learn is, the input parameters for SExtractor-like algorithms should be carefully chosen not to ruin your final result.</p>
</div>
<div class="tip admonition">
<p class="admonition-title">Example</p>
<p>The difference is only about 2-3 ADU out of the sky value around 2000, i.e., only about 0.1%. The right panel of the last figure means it’s about <strong>0.2-σ offset</strong> (NOT 2-σ) by the sky RMS. Is this a serious problem?</p>
<p>The answer depends. If your image has FWHM of 10 (significantly oversampled, which is sometimes the case), the aperture radius you will use can be something like 30 pixels. The circular aperture area then will be <span class="math notranslate nohighlight">\(\pi (30)^2 \approx 3000 \,\mathrm{pix}^2\)</span>. With 1 ADU error in background, the source sum will be affected by 3000 ADU! If your object is quite faint so that its true count is only, say, <span class="math notranslate nohighlight">\(10^5\)</span> ADU, you will have 3% <strong>systematic</strong> offset in your flux. It is not a random error, so this may cause a big trouble in your research especially if you are not aware of it.</p>
</div>
<div class="tip admonition">
<p class="admonition-title">Practice</p>
<p>What happens if <code class="docutils literal notranslate"><span class="pre">box</span></code> and/or <code class="docutils literal notranslate"><span class="pre">filt</span></code> are increased to, e.g., 64 and 5? What happens if decreased? Try many combinations of these.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chaps"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="06-diffphot.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Differential Photometry</p>
      </div>
    </a>
    <a class="right-next"
       href="08-extended.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Extended Source Photometry</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sextractor">2.1. SExtractor</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">2.1.1. Introduction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#documentations">2.1.2. Documentations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementations-in-python">2.1.3. Implementations in Python</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sextractor-algorithm">2.2. SExtractor Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-detailed-explanation">2.2.1. A Detailed Explanation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sky-estimation-by-photutils-background2d">2.3. Sky Estimation by <code class="docutils literal notranslate"><span class="pre">photutils.Background2D</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sky-estimation-from-sep">2.4. Sky Estimation from <code class="docutils literal notranslate"><span class="pre">sep</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Yoonsoo P. Bach
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>